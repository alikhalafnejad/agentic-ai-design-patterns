### **فصل ۵: الگوی برنامه‌ریزی (The Planning Pattern)**

بسیاری از درخواست‌های معنی‌دار کاربران، وظایفی تک‌مرحله‌ای نیستند. آن‌ها اهداف پیچیده‌ای هستند که برای دستیابی به آن‌ها به یک سری اقدامات هماهنگ نیاز است. برای مثال، درخواست «یک سفر آخر هفته به شمال برای من برنامه‌ریزی کن» نمی‌تواند با یک جستجوی ساده یا یک فراخوانی API پاسخ داده شود. این درخواست نیازمند یافتن مسیر، بررسی وضعیت آب و هوا، رزرو اقامتگاه و شاید پیدا کردن رستوران‌های محلی است. یک عامل ساده و واکنشی (reactive agent) که فقط به یک دستور در یک زمان پاسخ می‌دهد، در مواجهه با چنین پیچیدگی‌هایی دچار مشکل خواهد شد.

الگوی برنامه‌ریزی (Planning Pattern) عامل را قادر می‌سازد تا از یک مجری ساده دستورات، به یک استراتژیست تبدیل شود. این الگو به عامل اجازه می‌دهد تا قبل از انجام هر کاری، یک «نقشه راه» ایجاد کند و یک هدف سطح بالا را به مجموعه‌ای از گام‌های مشخص و قابل اجرا تقسیم نماید.

#### **مشکل (Problem)**

چگونه می‌توان یک عامل را قادر ساخت تا وظایف چندمرحله‌ای و پیچیده را به طور قابل اعتماد و خودمختار انجام دهد؟ چگونه عامل می‌تواند توالی صحیح اقدامات را تعیین کند، وابستگی‌های بین گام‌ها را مدیریت نماید و در طول مسیر پیشرفت خود را پیگیری کند؟

بدون یک برنامه، یک عامل به راحتی ممکن است در میان راه گم شود، مراحل حیاتی را فراموش کند، یا اقدامات را به ترتیبی نادرست انجام دهد که منجر به شکست در رسیدن به هدف نهایی کاربر می‌شود.

#### **راه‌حل (Solution)**

الگوی برنامه‌ریزی یک مرحله اولیه «تفکر» یا «برنامه‌ریزی» را معرفی می‌کند. قبل از شروع اجرا، عامل از مدل زبانی بزرگ (LLM) خود استفاده می‌کند تا هدف پیچیده کاربر را تجزیه (decompose) کرده و یک برنامه گام به گام برای رسیدن به آن ایجاد کند. این برنامه به عنوان یک راهنمای اجرایی عمل می‌کند که عامل در طول فرآیند از آن پیروی می‌کند.

این رویکرد تضمین می‌کند که عامل یک درک جامع از آنچه باید انجام شود دارد و می‌تواند اقدامات خود را به صورت منطقی و ساختاریافته پیش ببرد.

#### **نحوه کارکرد (How It Works)**

پیاده‌سازی الگوی برنامه‌ریزی معمولاً یک چرخه دو فازی را دنبال می‌کند: برنامه‌ریزی و اجرا.

1.  **فاز ۱: برنامه‌ریزی (Planning):**
    *   **تجزیه وظیفه (Task Decomposition):** عامل، هدف سطح بالای کاربر را دریافت می‌کند. سپس یک پرامپت (prompt) تخصصی به مدل زبانی بزرگ ارسال می‌کند و از آن می‌خواهد که هدف را به لیستی از وظایف فرعی (sub-tasks) کوچکتر و مشخص‌تر تقسیم کند. خروجی این مرحله یک لیست مرتب از اقدامات است.
    *   **مثال پرامپت برنامه‌ریزی:** "شما یک دستیار هوشمند هستید. هدف زیر را به یک برنامه گام به گام تقسیم کنید. هر گام باید یک اقدام واضح و منفرد باشد. هدف: برای من یک میز برای دو نفر در یک رستوران ایتالیایی با رتبه بالا در تهران برای جمعه شب ساعت ۸ رزرو کن."
    *   **خروجی برنامه (نمونه):**
        1.  جستجو برای "بهترین رستوران‌های ایتالیایی در تهران" با استفاده از ابزار جستجو.
        2.  فیلتر کردن نتایج برای پیدا کردن رستوران‌هایی با امتیاز بالای ۴.۵.
        3.  برای ۳ رستوران برتر، بررسی امکان رزرو آنلاین در روز جمعه ساعت ۸ شب با استفاده از ابزار رزرو.
        4.  در صورت موفقیت‌آمیز بودن رزرو، جزئیات آن را به کاربر تأیید کن.
        5.  اگر هیچ‌کدام در دسترس نبودند، به کاربر اطلاع بده و گزینه‌های جایگزین را پیشنهاد کن.

2.  **فاز ۲: اجرا (Execution):**
    *   **اجرای گام به گام:** عامل شروع به اجرای برنامه می‌کند، یک گام در هر زمان.
    *   **مشاهده و به‌روزرسانی:** پس از اجرای هر گام (مثلاً فراخوانی یک ابزار)، عامل نتیجه را مشاهده می‌کند. این نتیجه به حافظه کاری یا «دفترچه یادداشت» (scratchpad) عامل اضافه می‌شود.
    *   **ادامه یا برنامه‌ریزی مجدد (Re-planning):** عامل گام بعدی در برنامه را با توجه به اطلاعات جدیدی که به دست آورده است، اجرا می‌کند. در سناریوهای پیشرفته‌تر، اگر نتیجه یک گام غیرمنتظره باشد (مثلاً یک خطا یا اطلاعات متناقض)، عامل ممکن است به فاز برنامه‌ریزی بازگردد تا بقیه برنامه خود را بر اساس شرایط جدید، اصلاح و به‌روز کند. این قابلیت انطباق، وجه تمایز عامل‌های برنامه‌ریز قدرتمند است.

این چرخه تا زمانی که تمام گام‌های برنامه تکمیل شوند یا عامل به این نتیجه برسد که هدف قابل دستیابی نیست، ادامه می‌یابد.

#### **مزایا (Benefits)**

*   **مدیریت وظایف پیچیده:** این الگو عامل را قادر می‌سازد تا وظایفی را که بسیار فراتر از قابلیت‌های یک عامل واکنشی ساده هستند، با موفقیت به انجام رساند.
*   **شفافیت و قابلیت اشکال‌زدایی (Transparency and Debuggability):** از آنجایی که برنامه از قبل ایجاد می‌شود، می‌توان «فرآیند فکری» عامل را مشاهده کرد. اگر فرآیند با شکست مواجه شود، دقیقاً مشخص است که در کدام گام مشکل رخ داده است.
*   **قابلیت اطمینان بالاتر:** تجزیه یک مشکل بزرگ به مشکلات کوچکتر، احتمال موفقیت در هر مرحله را افزایش می‌دهد و از سردرگمی مدل زبانی بزرگ در طول یک زنجیره طولانی از استدلال‌ها جلوگیری می‌کند.
*   **انعطاف‌پذیری:** عامل‌های برنامه‌ریز پیشرفته می‌توانند در صورت مواجهه با موانع غیرمنتظره، برنامه‌های خود را به صورت پویا تطبیق دهند.

#### **ملاحظات و چالش‌ها (Considerations and Challenges)**

*   **هزینه اولیه برنامه‌ریزی:** مرحله برنامه‌ریزی، خود یک فراخوانی به مدل زبانی بزرگ است که باعث ایجاد تأخیر و هزینه اولیه قبل از شروع هرگونه اقدام واقعی می‌شود. برای وظایف بسیار ساده، این الگو ممکن است غیرضروری باشد.
*   **شکنندگی برنامه (Plan Brittleness):** یک برنامه سفت و سخت ممکن است در دنیای واقعی که شرایط به سرعت تغییر می‌کند، با شکست مواجه شود. عامل باید توانایی تشخیص زمان نیاز به برنامه‌ریزی مجدد را داشته باشد.
*   **انتشار خطا (Error Propagation):** یک خطا یا نتیجه ضعیف در یکی از گام‌های اولیه می‌تواند کل برنامه را بی‌اثر کند و گام‌های بعدی را بر اساس فرضیات نادرست پیش ببرد.
*   **توهم در برنامه‌ریزی (Planning Hallucinations):** مدل زبانی بزرگ ممکن است برنامه‌ای ایجاد کند که شامل گام‌های غیرممکن یا استفاده از ابزارهایی باشد که وجود ندارند. سیستم اجرایی باید برای مدیریت چنین مواردی قوی باشد.

در فصل بعدی، ما به طور عمیق‌تری به یکی از اجزای کلیدی که توسط الگوی برنامه‌ریزی به شدت مورد استفاده قرار می‌گیرد، خواهیم پرداخت: **الگوی استفاده از ابزار (The Tool Use Pattern)**.